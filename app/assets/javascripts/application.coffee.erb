
#= require services
#= require directives
#= require filters

# --
# attachments app (angular directives, services, controllers)
# --

# app or module dependencies
deps = [
	'ngResource',
	'ngRoute',
	'attachments.filters',
	'attachments.services',
	'attachments.directives'
]

app = angular.module 'attachments', deps

app.run ([
	'$rootScope', '$location', '$window',
	(self, $location, $window)->
		console.log("Attachments.IO - Started")

])


app.value "Config",
	SYNC_STATUS_FINISHED: 2
	SYNC_STATUS_INPROCESS: 1
	SYNC_STATUS_ERROR: 0

app.controller('MainPageCtrl', [
	'$scope', 'EventSource', '$routeParams', 'API', 'Config',
	($scope, EventSource, $routeParams, API, Config) ->

		source = EventSource
		$scope.config = Config

		API.me.get (me) ->
			$scope.me = me

		API.emails.get (emails) ->
			$scope.emails = emails
			console.log $scope


  source.addEventListener('message', (event) ->
    console.log(JSON.parse(event.data))
  )

#		API.sync.get {id: $routeParams.id}, (response) ->
#			$scope.files = response.files
#			$scope.sync = response.sync
#
#			source.addEventListener('progressbar', (event) ->
#				data = JSON.parse event.data
#				console.log('progressbar', data)
#			)
#
#			source.addEventListener('synchronization_add_file', (event) ->
#				data = JSON.parse(event.data);
#				console.log('synchronization_add_file', data)
#			)
#
#			source.addEventListener('synchronization_update', (event) ->
#				data = JSON.parse(event.data)
#				console.log('synchronization_update', data)
#
#			);

])