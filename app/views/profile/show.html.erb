<% if @user.now_synchronizes? %>
  <div class="alert alert-success">
    <p><strong>Synchronization in process. Please, wait..</strong></p>
  </div>
<% else %>
  <p>
    <%= link_to sync_start_path, class: 'btn btn-success' do %>
      <span class="glyphicon glyphicon-play"></span>
      Start synchronization
    <% end %>
    <%= link_to resync_start_path, class: 'btn btn-danger', confirm: 'Reallly? O_o' do %>
      <span class="glyphicon glyphicon-play"></span>
      Re-synchronize all emails
    <% end %>
  </p>
<% end %>

<% unless @user.last_sync.nil? %>
  <p>Last synchronized at: <%= Time.at(@user.last_sync).to_formatted_s(:long) %></p>
<% end %>

<p>Time for next synchronization: ~ <%= 10 - Time.now.min % 10 %> min.</p>

<div class="debug-area">
  <span class="toggle-debug-code">Show / Hide debug</span>
  <pre class="debug-code">
    <%= @user.to_yaml %>
    <%= @user.profile.to_yaml %>
    <%= @user.settings.to_yaml %>
    <%= @user.filters.to_yaml %>
    <%= @user.tokens.to_yaml %>
  </pre>
</div>

<% unless @emails.empty? %>
  <h2>Account: <%= current_user.email %></h2>
  <table class="table table-striped">
    <% @emails.each do |email| %>
      <tr>
        <td>
          <p><strong><%= email.subject %> <span class="label label-info"><%= email.label %></span></strong></p>
          <p><small>From: <%= email.from %> | To: <%= email.to %> | Date: <%= Time.at(email.date).to_formatted_s(:long) %></small></p>
          <p>Files:</p>
          <ul>
            <% email.files.each do |file| %>
              <li><%= link_to file.filename, file.link, target: '_blank' %> <small>(size: <%= number_to_human_size(file.size) %>)</small></li>
            <% end %>
          </ul>
        </td>
      </tr>
    <% end %>
  </table>
<% end %>